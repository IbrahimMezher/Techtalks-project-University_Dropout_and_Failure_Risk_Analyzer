<!doctype html>
<html lang="en" data-theme="{{ current_user.theme_preference or 'light' }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Instructor Settings</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
  <style>
    main .card{ margin-bottom: 16px; }
    .split{ display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .hint{ font-size:13px; color: var(--muted); font-weight:750; margin-top:6px; }
    .divider{ height:1px; background: rgba(15,23,42,.08); margin: 14px 0; }
    @media (max-width: 900px){
      .settings-container{ grid-template-columns: 1fr; }
      .split{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="bg-grid"></div>
  <div class="bg-blob blob-1"></div>
  <div class="bg-blob blob-2"></div>

  <header class="appbar">
    <div class="appbar-inner">
      <div class="brand">
        <span class="brand-dot"></span>
        <span class="brand-name">Dropout Analyzer</span>
      </div>

      <nav class="nav">
        <a class="nav-item {% if active_page=='dashboard' %}active{% endif %}" href="{{ url_for('instructor.instructor_log') }}">Dashboard</a>
        <a class="nav-item {% if active_page=='students' %}active{% endif %}" href="{{ url_for('instructor.ins_students') }}">Students</a>
        <a class="nav-item {% if active_page=='reports' %}active{% endif %}" href="{{ url_for('instructor.reports') }}">Reports</a>
        <a class="nav-item {% if active_page=='settings' %}active{% endif %}" href="{{ url_for('instructor.settings') }}">Settings</a>
      </nav>
    </div>
  </header>

  <div class="settings-container">
    <aside class="settings-sidebar">
      <a class="sidebar-link {% if tab=='profile' %}active{% endif %}" href="{{ url_for('instructor.settings', tab='profile') }}">Profile Details</a>
      <a class="sidebar-link {% if tab=='notifications' %}active{% endif %}" href="{{ url_for('instructor.settings', tab='notifications') }}">Notifications</a>
      <a class="sidebar-link {% if tab=='security' %}active{% endif %}" href="{{ url_for('instructor.settings', tab='security') }}">Security & Password</a>
      <a href="{{ url_for('auth.logout') }}" class="sidebar-link danger">Logout</a>
    </aside>

    <main>
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="flashes" style="margin-bottom: 12px;">
            {% for category, message in messages %}
              <p class="flash {{ category }}">{{ message }}</p>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      {% if tab == 'profile' %}
        <div class="card">
          <div class="card-header">
            <h1>Profile Settings</h1>
            <p class="subtext">Update your personal info and preferences.</p>
          </div>

          <form class="form" action="{{ url_for('instructor.update_settings') }}" method="POST">
            <div class="split">
              <div class="field">
                <label>Full Name</label>
                <input type="text" name="name" value="{{ current_user.first_name }} {{ current_user.last_name }}" required>
                <div class="hint">Shown in your instructor profile.</div>
              </div>

              <div class="field">
                <label>Current Email</label>
                <input type="email" value="{{ current_user.email }}" disabled>
                <div class="hint">Change email from “Security & Password”.</div>
              </div>
            </div>

            <div class="divider"></div>

            <div class="field">
              <label>App Theme</label>
              <select name="theme" style="width:100%; padding:12px; border-radius:14px; border:1px solid rgba(15,23,42,.12); background: rgba(255,255,255,.82);">
                <option value="light" {% if (current_user.theme_preference or 'light') == 'light' %}selected{% endif %}>Light Mode</option>
                <option value="dark" {% if current_user.theme_preference == 'dark' %}selected{% endif %}>Dark Mode</option>
              </select>
              <div class="hint">Theme preference is saved on your account.</div>
            </div>

            <button type="submit" class="btn btn-primary" style="margin-top: 6px;">Save Changes</button>
          </form>
        </div>

        <div class="card">
          <div class="card-header">
            <h1>About Risk Indicators</h1>
            <p class="subtext">
              Risk levels are computed from aggregated attendance and grades to guide support and intervention.
            </p>
          </div>
          <p class="hint" style="margin:0;">
            This tool is intended for prevention and student success—use it to start conversations and offer help early.
          </p>
        </div>

      {% elif tab == 'security' %}
        <!-- SECURITY -->
        <div class="card">
          <div class="card-header">
            <h1>Change Email</h1>
            <p class="subtext">We will send a code to your new email before updating it.</p>
          </div>

          <form class="form" action="{{ url_for('auth.change_email_request') }}" method="POST">
            <div class="split">
              <div class="field">
                <label>New Email</label>
                <input type="email" name="new_email" placeholder="new@email.com" required>
                <div class="hint">You must verify the new email.</div>
              </div>

              <div class="field">
                <label>Confirm Password</label>
                <input type="password" name="password" placeholder="Your password" required>
                <div class="hint">Required to confirm it’s really you.</div>
              </div>
            </div>

            <button class="btn btn-primary" type="submit" style="margin-top:6px;">Send Verification Code</button>
          </form>

          {% if current_user.pending_email %}
            <p class="hint" style="margin-top:12px;">
              Pending email change: <strong>{{ current_user.pending_email }}</strong>.
              <a class="link" href="{{ url_for('auth.change_email_verify') }}">Enter the code</a>
            </p>
          {% endif %}
        </div>

        <div class="card">
          <div class="card-header">
            <h1>Change Password</h1>
            <p class="subtext">Choose a strong password you don’t reuse elsewhere.</p>
          </div>

         <form class="form" action="{{ url_for('auth.change_password') }}" method="POST">
  <div class="field">
    <label>Current Password</label>
    <input type="password" name="current_password" required>
  </div>

  <div class="split">
    <div class="field">
      <label>New Password</label>
      <input type="password" name="new_password1" required>
      <div class="hint">8+ chars, 1 uppercase, 1 special character.</div>
    </div>

    <div class="field">
      <label>Confirm New Password</label>
      <input type="password" name="new_password2" required>
    </div>
  </div>

  <button class="btn btn-primary" type="submit" style="margin-top:6px;">Update Password</button>
</form>
        </div>

      {% else %}
        <div class="card">
          <div class="card-header">
            <h1>Notifications</h1>
            <p class="subtext">Coming soon.</p>
          </div>
          <p class="hint" style="margin:0;">You can add email alerts and weekly summaries here later.</p>
        </div>
      {% endif %}
    </main>
  </div>
</body>
</html>